<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>AVIATOR IA SMART</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  background:#0e1117;
  color:#eaeaea;
  font-family:system-ui, Arial;
  margin:0;
  padding:20px;
  display:flex;
  justify-content:center;
}
.app{max-width:420px;width:100%}
.card{
  background:#161b22;
  border-radius:14px;
  padding:16px;
  margin-bottom:15px;
  box-shadow:0 0 0 1px #222;
}
h2,h3{margin:0 0 10px 0;font-weight:600}
input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:none;
  font-size:16px;
}
input{
  background:#0d1117;
  color:white;
  border:1px solid #30363d;
}
button{
  background:#238636;
  color:white;
  cursor:pointer;
}
button.red{background:#da3633}
.small{font-size:13px;color:#aaa}
canvas{width:100%;height:50px;border-radius:8px}
.good{color:#3fb950}
.bad{color:#f85149}
.warn{color:#d29922}
</style>
</head>

<body>
<div class="app">

<div class="card">
  <h2>AVIATOR IA SMART</h2>
  <div class="small">Prédictions filtrées & auto-learning</div>
</div>

<div class="card">
  <input id="v" type="number" step="0.01" placeholder="Dernière cote ROSE (ex: 6.20)">
  <input id="m" type="number" placeholder="Minute (0–59)">
  <input id="s" type="number" placeholder="Seconde (0–59)">
  <button onclick="predict()">Analyser</button>
</div>

<div class="card" id="result" style="display:none">
  <div id="prediction" style="font-size:20px;font-weight:bold"></div>
  <div id="info" class="small"></div>
  <div id="multi" style="margin-top:10px"></div>
</div>

<div class="card">
  <button onclick="record(true)">GAGNÉ ✅</button>
  <button class="red" onclick="record(false)">PERDU ❌</button>
</div>

<div class="card">
  <h3>Score Global IA</h3>
  <div id="score">50%</div>
</div>

<div class="card">
  <h3>Heatmap des secondes</h3>
  <canvas id="heatmap" width="300" height="50"></canvas>
  <div class="small">Vert = fiable • Rouge = dangereux</div>
</div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("aviatorAI")) || {
  heat:Array.from({length:60},()=>({w:0,l:0})),
  score:50
};
let lastS=null;

/* ===== PRÉDICTION ===== */
function predict(){
  const v = parseFloat(document.getElementById("v").value);
  const m = parseInt(document.getElementById("m").value);
  const s = parseInt(document.getElementById("s").value);

  if(isNaN(v)||isNaN(m)||isNaN(s)||m<0||m>59||s<0||s>59){
    alert("Valeurs invalides");
    return;
  }

  lastS = s;
  const h = data.heat[s];
  const diff = h.w - h.l;

  document.getElementById("result").style.display="block";

  // seconde dangereuse
  if(h.l >= h.w + 2){
    document.getElementById("prediction").innerHTML =
      "<span class='bad'>SECONDE ROUGE</span>";
    document.getElementById("info").innerText =
      "Historique négatif — signal annulé";
    document.getElementById("multi").innerHTML="";
    return;
  }

  let base = 1.6 + (v/12) + ((m*60+s)%30)/30 + diff*0.05;

  let html="";
  let count=0;

  for(let i=1;i<=4;i++){
    let pred = (base + i*0.15).toFixed(2);
    if(pred > 4){
      count++;
      html += `⏭ Tour +${i} : <b class="good">${pred}x</b><br>`;
    }
  }

  if(count===0){
    document.getElementById("prediction").innerHTML =
      "<span class='bad'>AUCUN SIGNAL</span>";
    document.getElementById("info").innerText =
      "Aucune prédiction > 4.00x";
    document.getElementById("multi").innerHTML="";
    return;
  }

  document.getElementById("prediction").innerHTML =
    "SIGNALS IA (> 4.00x)";
  document.getElementById("info").innerText =
    "Basé sur le dernier ROSE à " + m + ":" + s;
  document.getElementById("multi").innerHTML = html;
}

/* ===== APPRENTISSAGE ===== */
function record(win){
  if(lastS===null)return;
  win?data.heat[lastS].w++:data.heat[lastS].l++;
  data.score += win?2:-3;
  data.score=Math.max(0,Math.min(100,data.score));
  localStorage.setItem("aviatorAI",JSON.stringify(data));
  document.getElementById("score").innerText=data.score+"%";
  drawHeat();
}

/* ===== HEATMAP ===== */
function drawHeat(){
  const c=document.getElementById("heatmap");
  const ctx=c.getContext("2d");
  ctx.clearRect(0,0,300,50);
  for(let i=0;i<60;i++){
    let d=data.heat[i];
    let diff=d.w-d.l;
    let a=Math.min(Math.abs(diff)/5,1);
    ctx.fillStyle=
      diff>1?`rgba(63,185,80,${a})`:
      diff<-1?`rgba(248,81,73,${a})`:
      `rgba(210,153,34,0.5)`;
    ctx.fillRect(i*5,0,5,50);
  }
}
drawHeat();
document.getElementById("score").innerText=data.score+"%";
</script>

</body>
</html>
